<div class="write-review-container">

    <!-- BotÃ³n para mostrar/ocultar formulario -->
  <div class="review-trigger">
    <div *ngIf="!isLoggedIn" class="login-prompt">
      <p>ğŸ’¡ <strong>Inicia sesiÃ³n</strong> para escribir una reseÃ±a sobre este libro</p>
    </div>
    
    <div *ngIf="isLoggedIn && !canWriteReview" class="already-reviewed">
      <p>âœ… Ya escribiste una reseÃ±a para este libro</p>
    </div>
    
    <button 
      *ngIf="canWriteReview" 
      (click)="toggleForm()" 
      class="btn-write-review"
      [class.active]="showForm">
      {{ showForm ? 'âŒ Cancelar' : 'âœï¸ Escribir ReseÃ±a' }}
    </button>
  </div>

  <!-- Formulario de reseÃ±a -->
  <div *ngIf="showForm" class="review-form">
    <div class="form-header">
      <h3>âœï¸ Escribe tu reseÃ±a de "{{ bookTitle }}"</h3>
      <p>Comparte tu experiencia con otros lectores</p>
    </div>

    <form (ngSubmit)="submitReview()" #reviewForm="ngForm">
      
      <!-- Rating con estrellas -->
      <div class="rating-section">
        <label>CalificaciÃ³n *</label>
        <div class="star-rating">
          <span 
            *ngFor="let star of [1,2,3,4,5]" 
            [class]="getStarClass(star)"
            (click)="setRating(star)"
            (mouseenter)="setHoveredRating(star)"
            (mouseleave)="clearHoveredRating()">
            â˜…
          </span>
          <span *ngIf="rating > 0" class="rating-text">
            {{ rating }} de 5 estrellas
          </span>
        </div>
      </div>

      <!-- TÃ­tulo de la reseÃ±a -->
      <div class="form-group">
        <label for="reviewTitle">TÃ­tulo de tu reseÃ±a *</label>
        <input 
          type="text" 
          id="reviewTitle"
          [(ngModel)]="title"
          name="title"
          maxlength="100"
          placeholder="Resumen de tu experiencia..."
          class="form-input"
          required>
        <div class="char-counter">
          {{ getRemainingChars('title') }} caracteres restantes
        </div>
        <div *ngIf="title.length > 0 && title.length < 5" class="error-text">
          MÃ­nimo 5 caracteres
        </div>
      </div>

      <!-- Contenido de la reseÃ±a -->
      <div class="form-group">
        <label for="reviewContent">Tu reseÃ±a *</label>
        <textarea 
          id="reviewContent"
          [(ngModel)]="content"
          name="content"
          maxlength="500"
          rows="5"
          placeholder="CuÃ©ntanos quÃ© te pareciÃ³ el libro, quÃ© te gustÃ³, quÃ© no te gustÃ³..."
          class="form-textarea"
          required>
        </textarea>
        <div class="char-counter">
          {{ getRemainingChars('content') }} caracteres restantes
        </div>
        <div *ngIf="content.length > 0 && content.length < 20" class="error-text">
          MÃ­nimo 20 caracteres
        </div>
      </div>

      <!-- InformaciÃ³n del usuario -->
      <div class="user-info">
        <img [src]="currentUser?.avatar" [alt]="currentUser?.name" class="user-avatar">
        <div class="user-details">
          <strong>{{ currentUser?.name }}</strong>
          <span class="verified-badge">âœ… Compra verificada</span>
        </div>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <button 
          type="button" 
          (click)="toggleForm()" 
          class="btn-cancel">
          Cancelar
        </button>
        
        <button 
          type="submit" 
          [disabled]="!isFormValid() || isSubmitting"
          class="btn-submit">
          <span *ngIf="!isSubmitting">ğŸ“ Publicar ReseÃ±a</span>
          <span *ngIf="isSubmitting">â³ Enviando...</span>
        </button>
      </div>
    </form>
  </div>
</div>